# Production Environment Configuration Template
# Copy this file to .env.production and fill in your actual values

# ============================================================================
# PostgreSQL Configuration (Managed Service)
# ============================================================================

# Connection URL for managed PostgreSQL
# Examples:
#   AWS RDS: postgresql://username:password@mydb.123456789.us-east-1.rds.amazonaws.com:5432/ticketing?sslmode=require
#   GCP Cloud SQL: postgresql://username:password@/ticketing?host=/cloudsql/project:region:instance&sslmode=require
#   Azure Database: postgresql://username:password@myserver.postgres.database.azure.com:5432/ticketing?sslmode=require
DATABASE_URL=postgresql://username:password@your-managed-postgres-host:5432/ticketing

# Connection pool settings
DATABASE_MAX_CONNECTIONS=20
DATABASE_MIN_CONNECTIONS=5
DATABASE_CONNECT_TIMEOUT=30
DATABASE_STATEMENT_TIMEOUT=60
DATABASE_IDLE_TIMEOUT=600

# SSL Configuration
# Options: disable, prefer, require, verify-ca, verify-full
# For production, use 'require' or 'verify-full'
DATABASE_SSL_MODE=require

# Path to SSL root certificate (required for verify-ca and verify-full)
# DATABASE_SSL_ROOT_CERT=/path/to/ca-cert.pem

# ============================================================================
# RedPanda/Kafka Configuration (Managed Service)
# ============================================================================

# Broker addresses (comma-separated)
# Examples:
#   Confluent Cloud: pkc-xxxxx.us-east-1.aws.confluent.cloud:9092
#   AWS MSK: b-1.mycluster.xxxxx.kafka.us-east-1.amazonaws.com:9096
#   Self-managed: redpanda-broker-1:9092,redpanda-broker-2:9092
REDPANDA_BROKERS=your-broker-1:9092,your-broker-2:9092

# Consumer group for projections
CONSUMER_GROUP=ticketing-projections

# Topic names
INVENTORY_TOPIC=ticketing-inventory-events
RESERVATION_TOPIC=ticketing-reservation-events
PAYMENT_TOPIC=ticketing-payment-events

# Security Configuration
# Options: plaintext, ssl, sasl_plaintext, sasl_ssl
# For production, use 'sasl_ssl'
REDPANDA_SECURITY_PROTOCOL=sasl_ssl

# SASL Configuration (required if using sasl_* security protocol)
# Mechanisms: PLAIN, SCRAM-SHA-256, SCRAM-SHA-512
REDPANDA_SASL_MECHANISM=SCRAM-SHA-256
REDPANDA_SASL_USERNAME=your-username
REDPANDA_SASL_PASSWORD=your-password

# SSL Configuration (required if using *_ssl security protocol)
# REDPANDA_SSL_CA_LOCATION=/path/to/ca-cert.pem

# Consumer settings for production reliability
REDPANDA_SESSION_TIMEOUT_MS=45000
REDPANDA_HEARTBEAT_INTERVAL_MS=3000
REDPANDA_MAX_POLL_INTERVAL_MS=300000
REDPANDA_ENABLE_AUTO_COMMIT=true
REDPANDA_AUTO_COMMIT_INTERVAL_MS=5000

# ============================================================================
# Server Configuration
# ============================================================================

# Application server
HOST=0.0.0.0
PORT=8080

# Logging level: trace, debug, info, warn, error
RUST_LOG=info

# Metrics server (for Prometheus scraping)
METRICS_HOST=0.0.0.0
METRICS_PORT=9090

# Graceful shutdown timeout (seconds)
SHUTDOWN_TIMEOUT=30

# ============================================================================
# Deployment Notes
# ============================================================================

# AWS Deployment:
# - Use RDS for PostgreSQL with Multi-AZ for high availability
# - Use MSK for Kafka-compatible event streaming
# - Store credentials in AWS Secrets Manager
# - Use IAM roles for service authentication where possible

# GCP Deployment:
# - Use Cloud SQL for PostgreSQL with high availability
# - Use self-managed RedPanda on GKE or Confluent Cloud
# - Store credentials in Secret Manager
# - Use Workload Identity for service authentication

# Azure Deployment:
# - Use Azure Database for PostgreSQL with high availability
# - Use Azure Event Hubs (Kafka-compatible) or self-managed RedPanda on AKS
# - Store credentials in Key Vault
# - Use Managed Identities for service authentication

# Connection Pooling Best Practices:
# - Set max_connections based on expected load (typically 2-5x number of CPU cores)
# - Set min_connections to handle baseline traffic
# - Monitor connection pool saturation metrics
# - Tune statement_timeout to prevent long-running queries

# Security Best Practices:
# - Always use SSL/TLS in production (DATABASE_SSL_MODE=require or verify-full)
# - Rotate credentials regularly
# - Use separate credentials for each service
# - Enable audit logging on database and message broker
# - Use network isolation (VPC, private subnets)
# - Enable encryption at rest and in transit
